{% extends "base.html" %}
{% load core_extras %}
{% block title %}Requests | Trupti{% endblock %}
{% block content %}
  <div class="card-trupti p-4 mb-4">
    <div class="d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between gap-2">
      <div>
        <h1 class="section-heading fs-3 mb-2">{% if user.is_donor %}Incoming requests{% else %}My requests{% endif %}</h1>
        <p class="text-muted mb-0">Monitor live updates and respond swiftly to keep meals moving.</p>
      </div>
      <a class="btn-trupti-outline" href="{% url 'donation_list' %}">Browse donations</a>
    </div>
  </div>

  {% if requests %}
    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>Donation</th>
            {% if user.is_donor %}<th>Receiver</th>{% endif %}
            <th>Status</th>
            <th>Requested at</th>
            {% if user.is_donor %}<th class="text-end">Actions</th>{% endif %}
          </tr>
        </thead>
        <tbody>
          {% for request_item in requests %}
            <tr>
              <td class="fw-semibold">{{ request_item.donation.food_name }}</td>
              {% if user.is_donor %}<td>{{ request_item.receiver.username }}</td>{% endif %}
              <td><span class="status-badge bg-{{ request_item.status|status_badge_class }}">{{ request_item.get_status_display }}</span></td>
              <td>{{ request_item.timestamp|date:"M d, Y H:i" }}</td>
              {% if user.is_donor %}
                <td class="text-end">
                  {% if request_item.status == 'pending' %}
                    <form method="post" action="{% url 'update_request_status' request_item.pk %}" class="d-inline">
                      {% csrf_token %}
                      <input type="hidden" name="action" value="accept" />
                      <button class="btn-trupti btn-sm">Accept</button>
                    </form>
                    <form method="post" action="{% url 'update_request_status' request_item.pk %}" class="d-inline">
                      {% csrf_token %}
                      <input type="hidden" name="action" value="reject" />
                      <button class="btn btn-sm btn-outline-danger">Reject</button>
                    </form>
                  {% else %}
                    <span class="text-muted">No actions</span>
                  {% endif %}
                </td>
              {% endif %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert alert-trupti alert-info">No requests to display.</div>
  {% endif %}
{% endblock %}
