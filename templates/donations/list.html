{% extends "base.html" %}
{% load core_extras %}
{% block title %}Donations | Trupti{% endblock %}
{% block content %}
  <div class="card-trupti p-4 mb-4">
    <div class="d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between gap-3">
      <div>
        <h1 class="section-heading fs-3 mb-2">Available donations</h1>
        <p class="text-muted mb-0">Curated meals ready to be shared. Filter by location or cuisine to find the perfect fit.</p>
      </div>
      {% if user.is_receiver %}
        <a class="btn-trupti-outline" href="{% url 'request_list' %}">My requests</a>
      {% endif %}
    </div>
  </div>

  <form class="card-trupti p-4 mb-4" method="get">
    <div class="row g-3">
      <div class="col-md-5">
        <input type="text" name="location" class="form-control" placeholder="Filter by location" value="{{ request.GET.location }}" />
      </div>
      <div class="col-md-5">
        <input type="text" name="food_name" class="form-control" placeholder="Filter by food name" value="{{ request.GET.food_name }}" />
      </div>
      <div class="col-md-2">
        <button class="btn-trupti w-100" type="submit">Filter</button>
      </div>
    </div>
  </form>

  {% if donations %}
    <div class="row g-4">
      {% for donation in donations %}
        <div class="col-md-4">
          <div class="card-trupti h-100 d-flex flex-column">
            <div class="card-body d-flex flex-column">
              <div class="d-flex align-items-center gap-2 mb-2">
                <span class="badge bg-light text-dark text-uppercase small">{{ donation.donor.username }}</span>
                <span class="text-muted small">{{ donation.available_till|date:"M d, Y" }}</span>
              </div>
              <h5 class="fw-semibold text-capitalize">{{ donation.food_name }}</h5>
              <p class="text-muted flex-fill">{{ donation.description|truncatechars:120 }}</p>
              <ul class="list-unstyled small mb-4 text-muted">
                <li><strong>Quantity:</strong> {{ donation.quantity }}</li>
                <li><strong>Address:</strong> {{ donation.address }}</li>
                <li><strong>Available till:</strong> {{ donation.available_till|date:"M d, Y H:i" }}</li>
              </ul>
              {% if user.is_authenticated and user.is_receiver and donation.status == 'available' %}
                <a class="btn-trupti w-100 mt-auto" href="{% url 'create_food_request' donation.pk %}">Request this meal</a>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-trupti alert-info">No donations available at the moment.</div>
  {% endif %}
{% endblock %}
